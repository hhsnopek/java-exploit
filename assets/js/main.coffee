require.config paths:
  moment: "/components/moment/moment"
  jquery: "//cdnjs.cloudflare.com/ajax/libs/jquery/2.0.3/jquery.min"

define ["moment", "jquery"], (moment, $) ->

  last_scrape = {}
  
  checklastscrape = () ->
    $.ajax(
      cache: false,
      url: '//api.java-exploit.com/api/last_scrape_date',
      success: (date) ->
        $('#total').html("Total - " + date["cvetotal"])
        window.last_scrape = date
    )
  
  setInterval(checklastscrape(), 600000)
  
  setInterval( () ->
    duration = moment.duration(moment().diff(+window.last_scrape["last_exploit_time"]*1000))
    fullduration = "#{duration.seconds()}s"
    list = ["#{duration.days()}d", "#{duration.hours()}h", "#{duration.minutes()}m"]
    for i in [0..list.length]
      if list[i][0] is '0'
        list[i] = ''
      else
        break
    fullduration = list.join " "
    $('#time').html("#{fullduration} #{duration.seconds()}s")
  1000
  )
  
  $(document).ready(
    $.ajax(
      url: '//api.java-exploit.com/api/java_cve_data'
      cache: false
      ).done( (data) ->
        currentexploit = '000'
        pastexploit = ''
        pastexploit = data[1] if pastexploit isnt currentexploit
        $('#exploit').html(pastexploit["name"])
        $ ->
          $('#exploitinfo').append("<blockquote>#{pastexploit['info']}</blockquote>")
        $ ->
          $('#cvelist').append("<ul><li class='name' id='#{data[i]["name"]}'>#{data[i]["name"]}</li><li>#{data[i]["info"]}</li></ul>") for i in [0...data.length]
      )
  )


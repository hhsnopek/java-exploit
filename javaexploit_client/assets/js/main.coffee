require.config paths:
	moment: "/components/moment/moment"
	jquery: "http://ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min"

define ["moment", "jquery"], (moment, $) ->
	last_scrape = {}
	checklastscrape = () ->
		$.ajax(
			async: false,
			url: '/data/last_scrape_date.json', 
			success: (date) ->
				$('#listbutton').html(date["cvetotal"])
				window.last_scrape = date
		)
	setInterval(checklastscrape() ,600000)
	setInterval( () ->
		duration = moment.duration(moment().diff(+window.last_scrape["last_exploit_time"]*1000))
		fullduration = "#{duration.seconds()}s"
		list = ["#{duration.days()}d", "#{duration.hours()}h", "#{duration.minutes()}m"]
		for i in [0..list.length]
			if list[i][0] is '0'
				list[i] = ''
			else
				break
		fullduration = list.join " "
		$('#days').html("#{fullduration} #{duration.seconds()}s")
	1000)
	$(document).ready(
		$.getJSON('/data/datacollection.json', (data) ->
			currentexploit = "000"
			pastexploit = ""
			if pastexploit isnt currentexploit
				pastexploit = data[1]
			$('#exploit').html(pastexploit["name"])
			$ ->
				$('#exploitinfo').append("<blockquote>#{pastexploit['info']}</blockquote>")
			$ ->
				for i in [0...data.length]
					$('#cvelist').append("<ul><li class='name'>#{data[i]["name"]}</li><li>#{data[i]["info"]}</li></ul>")
			cache: false
		))
	$('#listbutton').click( (event) ->
		$('#exploitinfo').css({"display": "none"})
		$('#cvelist').toggle('show')
	)
	$('#exploit').click( (event) ->
		$('#cvelist').css({"display": "none"})
		$('#exploitinfo').toggle('show')
	)

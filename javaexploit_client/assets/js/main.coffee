require.config paths:
	moment: "/components/moment/moment"
	jquery: "http://ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min"

define ["moment", "jquery"], (moment, $) ->
		setInterval( () ->
			$.getJSON('/data/last_scrape_date.json', (date) ->
				duration = moment.duration(moment().diff(+date["last_exploit_time"]*1000))
				fullduration = "#{duration.seconds()}s"
				list = ["#{duration.days()}d", "#{duration.hours()}h", "#{duration.minutes()}m"]
				for i in [0..list.length]
					if list[i][0] is '0'
						list[i] = ''
					else
						break
				fullduration = list.join " "
				$('#days').html("#{fullduration} #{duration.seconds()}s")
			)
		1000)
		$.getJSON('/data/datacollection.json', (data) ->
			currentexploit = "000"
			pastexploit = ""
			if pastexploit isnt currentexploit
				pastexploit = data[1]
			$('#info').html(pastexploit["name"])
			$ ->
				$('#exploitinfo').append("<blockquote>#{pastexploit['info']}</blockquote>")
			$ ->
				for i in [0...data.length]
					$('#cvelist').append("<tr><td class='name'>#{data[i]["name"]}</td><td>#{data[i]["info"]}</td></tr>")
		)
		$('#exploitbutton').click( (event) ->
			$('#cvelist').toggle('show')
		)
		$('#mobilebutton').click( (event) ->
			$('#cvelist').toggle('show')
		)
		$('#info').click( (event) ->
			$('#exploitinfo').toggle('show')
		)

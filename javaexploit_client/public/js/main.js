(function() {
  require.config({
    paths: {
      moment: "/components/moment/moment",
      jquery: "http://ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min"
    }
  });

  define(["moment", "jquery"], function(moment, $) {
    var checklastscrape, last_scrape;

    last_scrape = {};
    checklastscrape = function() {
      return $.ajax({
        async: false,
        url: '/data/last_scrape_date.json',
        success: function(date) {
          $('#listbutton').html(date["cvetotal"]);
          return window.last_scrape = date;
        }
      });
    };
    setInterval(checklastscrape(), 600000);
    setInterval(function() {
      var duration, fullduration, i, list, _i, _ref;

      duration = moment.duration(moment().diff(+window.last_scrape["last_exploit_time"] * 1000));
      fullduration = "" + (duration.seconds()) + "s";
      list = ["" + (duration.days()) + "d", "" + (duration.hours()) + "h", "" + (duration.minutes()) + "m"];
      for (i = _i = 0, _ref = list.length; 0 <= _ref ? _i <= _ref : _i >= _ref; i = 0 <= _ref ? ++_i : --_i) {
        if (list[i][0] === '0') {
          list[i] = '';
        } else {
          break;
        }
      }
      fullduration = list.join(" ");
      return $('#days').html("" + fullduration + " " + (duration.seconds()) + "s");
    }, 1000);
    $(document).ready($.getJSON('/data/datacollection.json', function(data) {
      var currentexploit, pastexploit;

      currentexploit = "000";
      pastexploit = "";
      if (pastexploit !== currentexploit) {
        pastexploit = data[1];
      }
      $('#exploit').html(pastexploit["name"]);
      $(function() {
        return $('#exploitinfo').append("<blockquote>" + pastexploit['info'] + "</blockquote>");
      });
      $(function() {
        var i, _i, _ref, _results;

        _results = [];
        for (i = _i = 0, _ref = data.length; 0 <= _ref ? _i < _ref : _i > _ref; i = 0 <= _ref ? ++_i : --_i) {
          _results.push($('#cvelist').append("<ul><li class='name'>" + data[i]["name"] + "</li><li>" + data[i]["info"] + "</li></ul>"));
        }
        return _results;
      });
      return {
        cache: false
      };
    }));
    $('#listbutton').click(function(event) {
      $('#exploitinfo').css({
        "display": "none"
      });
      return $('#cvelist').toggle('show');
    });
    return $('#exploit').click(function(event) {
      $('#cvelist').css({
        "display": "none"
      });
      return $('#exploitinfo').toggle('show');
    });
  });

}).call(this);

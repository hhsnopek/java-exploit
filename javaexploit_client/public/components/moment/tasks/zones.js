var path=require("path"),nodeunit=require("nodeunit"),moment=require("../moment");module.exports=function(e){function t(){r(u,function(){e.log.writeln("Resetting timezone back to "+u),c()})}function n(t){e.utils.spawn({cmd:"systemsetup",args:["gettimezone"]},function(e,n){t(n.stdout.replace("Time Zone: ",""))})}function i(t){e.utils.spawn({cmd:"systemsetup",args:["listtimezones"]},function(e,n){var i=n.stdout.replace("Time Zones:","");i=i.match(/\S+/g),t(i)})}function r(t,n){e.utils.spawn({cmd:"systemsetup",args:["settimezone",t]},function(){n()})}function o(e){var t=a.pop();t?r(t,function(){s(t,function(){o(e)})}):e()}function s(n,i){e.utils.spawn({cmd:"grunt",args:["zone"]},function(e,n){if(e)throw t(),e;console.log(n.stdout),i()})}var a,u,c;e.registerTask("zones","Run the unit tests in different timezones.",function(){c=this.async(),n(function(e){u=e,i(function(e){a=e,o(function(){t()})})})})};
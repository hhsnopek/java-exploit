var path=require("path"),nodeunit=require("nodeunit"),moment=require("../moment");module.exports=function(e){function t(){s(d,function(){e.log.writeln("Resetting timezone back to "+d),o()})}function n(t){e.utils.spawn({cmd:"systemsetup",args:["gettimezone"]},function(e,n){t(n.stdout.replace("Time Zone: ",""))})}function a(t){e.utils.spawn({cmd:"systemsetup",args:["listtimezones"]},function(e,n){var a=n.stdout.replace("Time Zones:","");a=a.match(/\S+/g),t(a)})}function s(t,n){e.utils.spawn({cmd:"systemsetup",args:["settimezone",t]},function(){n()})}function r(e){var t=_.pop();t?s(t,function(){i(t,function(){r(e)})}):e()}function i(n,a){e.utils.spawn({cmd:"grunt",args:["zone"]},function(e,n){if(e)throw t(),e;console.log(n.stdout),a()})}var _,d,o;e.registerTask("zones","Run the unit tests in different timezones.",function(){o=this.async(),n(function(e){d=e,a(function(e){_=e,r(function(){t()})})})})};
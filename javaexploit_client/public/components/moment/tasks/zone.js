var path=require("path"),nodeunit=require("nodeunit"),moment=require("../moment");module.exports=function(e){function t(t){e.utils.spawn({cmd:"systemsetup",args:["gettimezone"]},function(e,n){t(n.stdout.replace("Time Zone: ",""))})}function n(e,t){nodeunit.runFiles([path.join(process.cwd(),"test/moment"),path.join(process.cwd(),"test/lang")],{testDone:function(t,n){n.failures()&&o.push([e,t,n])},done:function(n){r(e,n),t()}})}function i(t,n,i){e.log.writeln(""),e.log.error(t+" failed: "+n),i.forEach(function(t){var n=t.error;t.failed()&&(t.message&&e.log.error(t.message),n&&n.actual&&n.expected&&n.operator&&e.log.error([n.actual,n.operator,n.expected].join(" ")))})}function r(t,n){var i=n.failures(),r=n.length-i,s=i?"XX".red:"OK".green,o=r+" passed",l=i?(i+" failed").red:i+" failed",d=""+-moment().zone()/60;e.log.writetableln(a,[s,d,t,o,l]),i?u++:c++}function s(){var t;if(u)for(e.log.writeln(u+" failures"),t=0;o.length>t;t++)i.apply(null,o[t])}var o=[],a=[4,6,46,12,12],u=0,c=0;e.registerTask("zone","Run the unit tests in the current timezone.",function(){var e=this.async();t(function(t){n(t,function(){s(),e()})})})};